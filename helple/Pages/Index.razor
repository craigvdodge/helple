@page "/"

<PageTitle>Helple</PageTitle>

<h1>Helple Word List</h1>

<div>
    <label>@ErrMsg</label>
    <label @onload="ReadWordsFile">@test</label>
</div>
<div hidden="@hideGuessBtn">
    <button @onclick="OnGuessBtnClick">Filter list with guess</button>
</div>
<div hidden="@hideGuessInput">
    <label>Enter guess to filter word list:</label>
    <input @bind="Guess" /><button @onclick="OnGuessClick">enter</button>
</div>
<div hidden="@hideGuessColorPicker">
    <div>
        <label>@ColorCodingArray[0].Letter</label>
        <select @bind="cc0">
            @foreach (var value in Enum.GetValues<ColorCode>())
            {
                <option>@value.ToString()</option>
            }
        </select>
    </div>
    <div>
        <label>@ColorCodingArray[1].Letter</label>
        <select @bind="cc1">
            @foreach (var value in Enum.GetValues<ColorCode>())
            {
                <option>@value.ToString()</option>
            }
        </select>
    </div>
    <div>
        <label>@ColorCodingArray[2].Letter</label>
        <select @bind="cc2">
            @foreach (var value in Enum.GetValues<ColorCode>())
            {
                <option>@value.ToString()</option>
            }
        </select>
    </div>
    <div>
        <label>@ColorCodingArray[3].Letter</label>
        <select @bind="cc3">
            @foreach (var value in Enum.GetValues<ColorCode>())
            {
                <option>@value.ToString()</option>
            }
        </select>
    </div>
    <div>
        <label>@ColorCodingArray[4].Letter</label>
        <select @bind="cc4">
            @foreach (var value in Enum.GetValues<ColorCode>())
            {
                <option>@value.ToString()</option>
            }
        </select>
    </div>
    <button @onclick="OnColorCodeClick">Filter list</button>
</div>
<div>
    <p>Word Suggestions</p>
    <select @bind="SelectedWord" size=20>
        @foreach (string word in Wordlist)
        {
            <option value="@word">@word</option>
        }
    </select>
    
</div>

@inject HttpClient _client

@code {
    // This is hella stupid, but I couldn't figure out how to bind the dropdown refering to an array memember. Brute force ftw.
    public ColorCode cc0;
    public ColorCode cc1;
    public ColorCode cc2;
    public ColorCode cc3;
    public ColorCode cc4;

    // "select" means user has not entered color code yet
    public enum ColorCode
    {
        Select=0,
        Black,
        Yellow,
        Green
    }

    public class ColorCodingInfo
    {
        public ColorCodingInfo(string letter, Int32 index)
        {
            Letter = letter;
            Index = index;
            Code = ColorCode.Select;
        }
        public string Letter { get; set; }
        public Int32 Index { get; set; }
        public ColorCode Code { get; set; }
    }

    public ColorCodingInfo[] ColorCodingArray = InitColorCodingArray();

    public static ColorCodingInfo[] InitColorCodingArray()
    {
        ColorCodingInfo[] retval = new ColorCodingInfo[5];
        for (int i=0; i<5; i++)
        {
            retval[i] = new ColorCodingInfo(string.Empty, i);
        }

        return retval;
    }

    private string? Guess { get; set; }
    private void OnGuessClick()
    {
        if (Guess == null || Guess.Length != 5)
        {
            ErrMsg = "Guess must be 5 characters.";
            return;
        }
        // TODO: more checking here
        ErrMsg = null;
        hideGuessColorPicker = false;
        hideGuessInput = true;
        Guess = Guess.ToUpper();

        // xfer Guess to ColorCodingInfo array
        for (int i=0; i<5; i++)
        {
            ColorCodingArray[i].Letter = Guess.Substring(i, 1);
            ColorCodingArray[i].Code = ColorCode.Select;
        }

    }
    private string? ErrMsg;
    private bool hideGuessColorPicker = true;
    private bool hideGuessInput = true;
    private bool hideGuessBtn = false;

    private void OnGuessBtnClick()
    {
        hideGuessBtn = true;
        hideGuessInput = false;
    }

    private void OnColorCodeClick()
    {
        // xfer codes from ccx variables to ColorCodingArray
        ColorCodingArray[0].Code = cc0;
        ColorCodingArray[1].Code = cc1;
        ColorCodingArray[2].Code = cc2;
        ColorCodingArray[3].Code = cc3;
        ColorCodingArray[4].Code = cc4;

        // Validation

        for (int i=0; i<5; i++)
        {
            Console.WriteLine(i.ToString() + ":" + ColorCodingArray[i].Code.ToString());
            if (ColorCodingArray[i].Code == ColorCode.Select)
            {
                ErrMsg = ColorCodingArray[i].Letter + " color not selected";
                return;
            }
        }

        ErrMsg = string.Empty;

        // TODO: Filter word list

        // Clean up 
        hideGuessColorPicker = true;
        hideGuessBtn = false;
        Guess = null;
        foreach (ColorCodingInfo cci in ColorCodingArray)
        {
            cci.Letter = string.Empty;
            cci.Code = ColorCode.Select;
        }
        cc0 = ColorCode.Select;
        cc1 = ColorCode.Select;
        cc2 = ColorCode.Select;
        cc3 = ColorCode.Select;
        cc4 = ColorCode.Select;
    }


    public List<string> Wordlist = new List<string>();
    public string SelectedWord = string.Empty;

    private async void ReadWordsFile()
    {
        test = "enter";
        try
        {
            var foo = _client.GetStringAsync("words.txt");
            await foo;
            string[] wordsTemp = foo.Result.Split(Environment.NewLine, StringSplitOptions.RemoveEmptyEntries);
            Wordlist.Clear();
            foreach (string w in wordsTemp)
            {
                Wordlist.Add(w);
            }

            test = "after await";
            Console.WriteLine("after await");
            //Wordlist.Add("hello");
            //Console.WriteLine(foo.Result);

        }
        catch (Exception e)
        {
            Console.WriteLine(e.Message);
        }
        finally
        {
            test = "finally";
        }
        test = "outside";
    }

    void SomeStartupMethod()
    {
        ReadWordsFile();
    }

    Task SomeStartupTask()
    {
        // Do some task based work
        return Task.CompletedTask;
    }

    protected override async Task OnInitializedAsync()
    {
        Wordlist.Add("Please wait");
        
        SomeStartupMethod();
        await SomeStartupTask();
    }

    private string test = "Initalize text";

}